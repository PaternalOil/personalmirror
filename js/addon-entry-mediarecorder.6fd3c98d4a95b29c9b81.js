(window.webpackJsonpGUI=window.webpackJsonpGUI||[]).push([[33],{1471:function(e,t,n){"use strict";t.a=(e,t)=>{const n=document.createElement("a");if(document.body.appendChild(n),navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(t,e);else if("download"in HTMLAnchorElement.prototype){const a=window.URL.createObjectURL(t);n.href=a,n.download=e,n.type=t.type,n.click(),window.setTimeout(()=>{document.body.removeChild(n),window.URL.revokeObjectURL(a)},1e3)}else{let e=window.open("","_blank");const n=new FileReader;n.onloadend=function(){e.location.href=n.result,e=null},n.readAsDataURL(t)}}},1522:function(e,t,n){(e.exports=n(10)(!1)).push([e.i,'.mediaRecorderPopup {\n  box-sizing: border-box;\n  width: 700px;\n  max-height: min(800px, 80vh);\n  max-width: 85%;\n  margin-top: 12vh;\n  overflow-y: auto;\n  margin-left: auto;\n  margin-right: auto;\n}\n\n.mediaRecorderPopup [class*="modal_header-item-title"] {\n  margin: 0; /* required because there is no close button */\n}\n\n.mediaRecorderPopupContent {\n  background-color: white;\n  padding: 1.5rem 2.25rem;\n}\n[theme="dark"] .mediaRecorderPopupContent {\n  color: var(--text-primary);\n  background-color: var(--ui-primary);\n}\n\n.mediaRecorderPopup p {\n  font-size: 1rem;\n  margin: 1rem auto;\n}\n\n.mediaRecorderPopup p :last-child {\n  margin-left: 1rem;\n}\n\n.mediaRecorderPopup[dir="rtl"] p :last-child {\n  margin-left: 0;\n  margin-right: 1rem;\n}\n\n#recordOptionSecondsInput,\n#recordOptionDelayInput {\n  width: 6rem;\n}\n\n.mediaRecorderPopupButtons {\n  margin-top: 1.5rem;\n}\n\n.mediaRecorderPopupButtons button {\n  margin-left: 0.5rem;\n}\n\n.mediaRecorderPopupButtons button:nth-of-type(1) {\n  color: black;\n}\n',""])},1587:function(e,t,n){"use strict";n.r(t),n.d(t,"resources",(function(){return r}));var a=n(1471),o=n(1522);const r={"userscript.js":async({addon:e,console:t,msg:n})=>{let o,r,c,d=!1,i=!1,l=null,s=null,m=null,p=[];for(;;){const u=await e.tab.waitForElement('div[class*="menu-bar_file-group"] > div:last-child:not(.sa-record)',{markAsSeen:!0,reduxEvents:["scratch-gui/mode/SET_PLAYER","fontsLoaded/SET_FONTS_LOADED","scratch-gui/locales/SELECT_LOCALE"]}),b=()=>{const t=Object.assign(document.createElement("div"),{className:e.tab.scratchClass("modal_modal-overlay")}),a=Object.assign(document.createElement("div"),{className:e.tab.scratchClass("modal_modal-content",{others:"mediaRecorderPopup"}),dir:e.tab.direction}),o=Object.assign(document.createElement("div"),{className:e.tab.scratchClass("modal_header")});o.appendChild(Object.assign(document.createElement("div"),{className:e.tab.scratchClass("modal_header-item","modal_header-item-title"),textContent:n("option-title")})),a.appendChild(o);const r=Object.assign(document.createElement("div"),{className:"mediaRecorderPopupContent"});r.appendChild(Object.assign(document.createElement("p"),{textContent:n("record-description"),className:"recordOptionDescription"}));const c=document.createElement("p"),d=Object.assign(document.createElement("input"),{type:"number",min:1,max:300,defaultValue:30,id:"recordOptionSecondsInput",className:e.tab.scratchClass("prompt_variable-name-text-input")}),i=Object.assign(document.createElement("label"),{htmlFor:"recordOptionSecondsInput",textContent:n("record-duration")});c.appendChild(i),c.appendChild(d),r.appendChild(c);const l=document.createElement("p"),s=Object.assign(document.createElement("input"),{type:"number",min:0,max:300,defaultValue:0,id:"recordOptionDelayInput",className:e.tab.scratchClass("prompt_variable-name-text-input")}),m=Object.assign(document.createElement("label"),{htmlFor:"recordOptionDelayInput",textContent:n("start-delay")});l.appendChild(m),l.appendChild(s),r.appendChild(l);const p=document.createElement("p"),u=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionAudioInput"}),b=Object.assign(document.createElement("label"),{htmlFor:"recordOptionAudioInput",textContent:n("record-audio"),title:n("record-audio-description")});p.appendChild(u),p.appendChild(b),r.appendChild(p);const h=document.createElement("p"),C=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!1,id:"recordOptionMicInput"}),g=Object.assign(document.createElement("label"),{htmlFor:"recordOptionMicInput",textContent:n("record-mic")});h.appendChild(C),h.appendChild(g),r.appendChild(h);const E=document.createElement("p"),O=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionFlagInput"}),v=Object.assign(document.createElement("label"),{htmlFor:"recordOptionFlagInput",textContent:n("record-after-flag")});E.appendChild(O),E.appendChild(v),r.appendChild(E);const f=document.createElement("p"),w=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionStopInput"}),k=Object.assign(document.createElement("label"),{htmlFor:"recordOptionStopInput",textContent:n("record-until-stop")});O.addEventListener("change",()=>{(w.disabled=!O.checked)&&(k.title=n("record-until-stop-disabled",{afterFlagOption:n("record-after-flag")}))}),f.appendChild(w),f.appendChild(k),r.appendChild(f);let x=null;const y=new Promise(e=>{x=e});let R=null;const S=e=>{a.contains(e.target)||R(null)};document.body.addEventListener("click",S,{capture:!0}),R=e=>{x(e),document.body.removeEventListener("click",S,{capture:!0}),t.remove()};const j=Object.assign(document.createElement("div"),{className:e.tab.scratchClass("prompt_button-row",{others:"mediaRecorderPopupButtons"})}),P=Object.assign(document.createElement("button"),{textContent:n("cancel")});P.addEventListener("click",()=>R(null),{once:!0}),j.appendChild(P);const T=Object.assign(document.createElement("button"),{textContent:n("start"),className:e.tab.scratchClass("prompt_ok-button")});return T.addEventListener("click",()=>R({secs:Number(d.value),delay:Number(s.value),audioEnabled:u.checked,micEnabled:C.checked,waitUntilFlag:O.checked,useStopSign:!w.disabled&&w.checked}),{once:!0}),j.appendChild(T),r.appendChild(j),a.appendChild(r),t.appendChild(a),document.body.appendChild(t),y},h=()=>{d=!1,o.textContent=n("record"),o.title="",r=null,p=[],clearTimeout(c),c=0,m&&(e.tab.traps.vm.runtime.off("PROJECT_STOP_ALL",m),m=null)},C=t=>{if(i)return e.tab.traps.vm.runtime.off("PROJECT_START",l),i=!1,l=null,s.abort(),s=null,void h();d&&r&&"inactive"!==r.state&&(t?h():(r.onstop=()=>{const e=new Blob(p,{type:"video/webm"});Object(a.a)("video.webm",e),h()},r.stop()))},g=async a=>{const u=Math.min(300,Math.max(1,a.secs));p=[],d=!0;const b=e.tab.traps.vm;let h;if(a.micEnabled)try{h=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(e){if("NotAllowedError"!==e.name&&"NotFoundError"!==e.name)throw e;a.micEnabled=!1}if(a.waitUntilFlag){i=!0,Object.assign(o,{textContent:n("click-flag"),title:n("click-flag-description")}),s=new AbortController;try{await Promise.race([new Promise(e=>{l=()=>e(),b.runtime.once("PROJECT_START",l)}),new Promise((e,t)=>{s.signal.addEventListener("abort",()=>t("aborted"),{once:!0})})])}catch(e){if("aborted"===e.message)return;throw e}}i=!1,l=s=null;const g=new MediaStream,E=b.runtime.renderer.canvas.captureStream();g.addTrack(E.getVideoTracks()[0]);const O=new AudioContext,v=O.createMediaStreamDestination();if(a.audioEnabled){const e=b.runtime.audioEngine.audioContext.createMediaStreamDestination();b.runtime.audioEngine.inputNode.connect(e);O.createMediaStreamSource(e.stream).connect(v)}if(a.micEnabled){O.createMediaStreamSource(h).connect(v)}(a.audioEnabled||a.micEnabled)&&g.addTrack(v.stream.getAudioTracks()[0]),r=new MediaRecorder(g,{mimeType:"video/webm"}),r.ondataavailable=e=>{p.push(e.data)},r.onerror=e=>{t.warn("Recorder error:",e.error),C(!0)},c=setTimeout(()=>C(!1),1e3*u),a.useStopSign&&(m=()=>C(),b.runtime.once("PROJECT_STOP_ALL",m));const f=a.delay||0,w=Math.floor(f);for(let e=0;e<w;e++)o.textContent=n("starting-in",{secs:w-e}),await new Promise(e=>setTimeout(e,975));setTimeout(()=>{o.textContent=n("stop"),r.start(1e3)},1e3*(f-w))};o||(o=Object.assign(document.createElement("div"),{className:"sa-record "+u.className,textContent:n("record")}),o.addEventListener("click",async()=>{if(d)C();else{const e=await b();if(!e)return void t.log("Canceled");g(e)}})),u.parentElement.appendChild(o)}},"style.css":n.n(o).a}}}]);